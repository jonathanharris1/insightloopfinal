<!doctype html>
<html lang="pt-BR">
<head>
<!-- Basic document metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>InsightLoop â€” Customer Success Intelligence</title>
<meta name="description" content="Plataforma B2B SaaS para E-commerce Customer Success â€” AnÃ¡lise de tickets e automaÃ§Ã£o com IA" />


<!-- Fonts / CSS (replace with your toolchain or Tailwind build) -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<!-- TODO: replace with your app.css or Tailwind output -->
<link rel="stylesheet" href="/assets/styles.css" />


<!-- Open Graph (kept minimal) -->
<meta property="og:title" content="InsightLoop - Customer Success Intelligence" />
<meta property="og:description" content="AnÃ¡lises e automaÃ§Ã£o para atendimento ao cliente de e-commerce" />


<!-- JS entry (defer) -->
<script defer src="/assets/app.js"></script>


<style>
/* Minimal layout helpers for a quick local preview. Remove when using Tailwind / design system. */
:root{--sidebar-width:16rem;--gap:16px;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif}
*{box-sizing:border-box}
body{margin:0;color:#0f172a;background:#f8fafc}
.app{display:flex;min-height:100vh}
.sidebar{width:var(--sidebar-width);background:#0b1220;color:#fff;padding:20px}
.sidebar h2{margin:0 0 8px}
.main{flex:1;display:flex;flex-direction:column}
header{height:64px;border-bottom:1px solid #e6e9ee;display:flex;align-items:center;justify-content:space-between;padding:0 24px;background:white}
.content{padding:24px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.card{background:white;border:1px solid #e6e9ee;border-radius:8px;padding:20px}
.cards-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:16px}
.chart{height:420px;min-height:240px}
.list{display:flex;flex-direction:column;gap:8px}
@media (max-width:900px){.cards-row,.grid{grid-template-columns:repeat(1,1fr)}}
</style>
</head>

<!-- BODY STARTS -->
<body>
<h1>Classifications#index</h1>
<p>Find me in app/views/classifications/index.html.erb</p>


<h1>Classifications</h1>

<%#= link_to "New Classification", new_classification_path %>

<ul>
  <% @classifications.each do |classification| %>
    <li>
      <%= link_to "#{classification.tag}", classifications_show_path %>
    </li>
  <% end %>
</ul>

<h1>Classifications by Tag (counts + cumulative %)</h1>

<div id="classificationChart" style="width:100%; max-width:1000px; height:500px;"></div>

<!-- CODE FOR THE GRAPHIC - START -->
<script>
document.addEventListener("turbo:load", function() {
  var el = document.getElementById("classificationChart");
  if (!el) return;

  var labels = <%= raw @chart_labels.to_json %>;
  var counts = <%= raw @chart_counts.to_json %>;
  var cumulative = <%= raw @chart_cumulative.to_json %>; // expected 0..100 values

  if (!labels.length) { el.innerHTML = "<p>No data</p>"; return; }

  // compute percent-of-total for bars (client-side) so bars fill 0..100 height
  var total = counts.reduce(function(s, v){ return s + (Number(v) || 0); }, 0) || 1;
  var countsPercent = counts.map(function(v){ return (Number(v) || 0) / total * 100; });

  var chart = echarts.init(el);

  var option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: { type: 'shadow' },
      formatter: function(params) {
        var s = params[0].name + '<br/>';
        params.forEach(function(p) {
          if (p.seriesType === 'bar') {
            var idx = p.dataIndex;
            s += p.marker + ' Count: ' + counts[idx] + ' (' + p.value.toFixed(2) + '%)<br/>';
          } else if (p.seriesType === 'line') {
            s += p.marker + ' Cumulative: ' + (Number(p.value)||0).toFixed(1) + '%<br/>';
          }
        });
        return s;
      }
    },

    legend: { data: ['Count','Cumulative %'], top: 6 },

    grid: { left:'6%', right:'6%', bottom:'18%', containLabel:true },

    xAxis: {
      type: 'category',
      data: labels,
      axisLabel: { interval: 0, rotate: labels.length > 10 ? 45 : 0, fontWeight: 'bold' }
    },

    // single yAxis used for scale but hidden visually
    yAxis: [{
      type: 'value',
      min: 0,
      max: 100,
      show: false,          // hide everything: line, ticks, labels, grid
      axisLine: { show: false },
      axisTick: { show: false },
      axisLabel: { show: false },
      splitLine: { show: false }
    }],

    series: [
      {
        name: 'Count',
        type: 'bar',
        data: countsPercent,
        barWidth: Math.min(60, Math.max(24, Math.floor((el.clientWidth||800)/labels.length) - 4)),
        itemStyle: { borderRadius: [6, 6, 0, 0] },
        label: {
          show: true,
          position: 'top',
          formatter: function(p){ return counts[p.dataIndex]; }
        }
      },
      {
        name: 'Cumulative %',
        type: 'line',
        yAxisIndex: 0,
        data: cumulative,
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        // show the cumulative percentage as label on each point
        label: {
          show: true,
          position: 'top',
          distance: 8,
          formatter: function(params) {
            var v = Number(params.value) || 0;
            return Math.round(v) + '%';
          },
          fontSize: 11,
          color: '#666'
        },
        itemStyle: { borderWidth: 1 }
      }
    ]
  };

  chart.setOption(option);
  window.addEventListener('resize', function() { chart.resize(); });
});
</script>
<!-- CODE FOR THE GRAPHIC - END -->




<div id="app" class="app">


<!-- SIDEBAR: navigation (kept minimal and accessible)
<aside class="sidebar" aria-label="Main navigation">
<div class="brand">
<div aria-hidden="true" style="width:48px;height:48px;border-radius:8px;background:#0ea5a4;display:flex;align-items:center;justify-content:center;font-weight:700">IL</div>
<h2>InsightLoop</h2>
<p style="margin:0;font-size:12px;opacity:0.8">Customer Success</p>
</div>


<nav aria-label="Primary">
<ul style="list-style:none;padding:12px 0;margin:0;display:flex;flex-direction:column;gap:6px">
<li><a href="/" data-nav="dashboard">Dashboard</a></li>
<li><a href="/conversations" data-nav="conversations">Conversas</a></li>
<li><a href="/analytics" data-nav="analytics">AnÃ¡lises</a></li>
<li><a href="/intelligence/questions" data-nav="faq">Perguntas & FAQ</a></li>
<li><a href="/settings" data-nav="settings">ConfiguraÃ§Ãµes</a></li>
</ul>
</nav>


<hr style="border:none;border-top:1px solid rgba(255,255,255,0.06);margin:16px 0" />


<section aria-labelledby="intelligence-title">
<h3 id="intelligence-title" style="font-size:12px;color:#cbd5e1;margin:0 0 8px">Intelligence</h3>
<ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px;font-size:14px">
<li><a href="/intelligence/complaints">ReclamaÃ§Ãµes</a></li>
<li><a href="/intelligence/product">Insights de Produto</a></li>
<li><a href="/analysis/conversations">Voice of Customer</a></li>
</ul>
</section>
</aside>-->


<!-- MAIN: header + content
<div class="main">
<header>
<div style="display:flex;align-items:center;gap:12px">
<button aria-label="Toggle sidebar" id="sidebarToggle">â˜°</button>
<div>
<h1 style="margin:0;font-size:16px">Bom dia, Ana</h1>
<p style="margin:0;font-size:12px;color:#6b7280">quarta-feira, 10 de dezembro de 2025</p>
</div>
</div>


<div>
<button id="dateRangeBtn" aria-haspopup="menu">Ãšltimos 7 dias â–¾</button>
</div>
</header>


<main class="content" id="main-content"> -->

<!-- KPI Cards -->
</div>
</section>


<!-- Pareto / 80-20 analysis -->
<section class="card" aria-labelledby="pareto-title">
<h2 id="pareto-title" style="margin:0 0 8px">AnÃ¡lise de Foco 80/20 (PrincÃ­pio de Pareto)</h2>
<p style="margin:0 0 12px;color:#6b7280">Identifique os poucos problemas (20%) que geram a maior parte do volume (80%)</p>


<div style="margin-bottom:12px;padding:12px;border-radius:6px;background:#ecfeff;border:1px solid #99f6e4">
<strong>ðŸ’¡ Insight:</strong>
<span>Focar nos 3 primeiros problemas ('Atraso na Entrega', 'Troca de Tamanho', 'Erro no Cupom') resolverÃ¡ <strong>80.9%</strong> do volume total.</span>
</div>


<!-- Placeholder chart: replace with Recharts/Chart.js integration -->
<div class="chart" role="img" aria-label="GrÃ¡fico Pareto â€” barras de volume e linha acumulada">
<!-- Minimal accessible SVG placeholder, keep for static export or use a canvas/chart lib -->
<svg width="100%" height="100%" viewBox="0 0 1000 320" preserveAspectRatio="none" aria-hidden="true">
<rect x="0" y="0" width="100%" height="100%" fill="#fff" />
<!-- simple bars for the first 6 categories (demo) -->
<rect x="60" y="40" width="70" height="220" fill="#0ea5a4" rx="4"></rect>
<rect x="150" y="90" width="70" height="170" fill="#0ea5a4" rx="4"></rect>
<rect x="240" y="140" width="70" height="120" fill="#0ea5a4" rx="4"></rect>
<rect x="330" y="200" width="70" height="60" fill="#0ea5a4" rx="4"></rect>
<!-- cumulative line (visual) -->
<polyline points="95,280 185,220 275,180 365,150" fill="none" stroke="#ef4444" stroke-width="3" />


<!-- X labels (kept short) -->
<text x="95" y="305" text-anchor="middle" font-size="11">Atraso</text>
<text x="185" y="305" text-anchor="middle" font-size="11">Tamanho</text>
<text x="275" y="305" text-anchor="middle" font-size="11">Cupom</text>
<text x="365" y="305" text-anchor="middle" font-size="11">NF</text>
</svg>
</div>
</section>


<!-- Top issues list (interactive items) -->
<section class="card" aria-labelledby="top-issues-title">
<h3 id="top-issues-title">Principais Problemas</h3>
<p style="margin:6px 0 12px;color:#6b7280">TÃ³picos em alta que precisam de atenÃ§Ã£o</p>


<div class="list" role="list">
<!-- Use data attributes to attach click handlers and IDs -->
<div role="listitem" class="card" style="display:flex;justify-content:space-between;align-items:center">
<div>
<strong>Atraso na Entrega</strong>
<div style="font-size:12px;color:#6b7280">456 ocorrÃªncias</div>
</div>
<div style="text-align:right">
<div style="font-size:12px;color:#ef4444;font-weight:600">+23%</div>
</div>
</div>


<div role="listitem" class="card" style="display:flex;justify-content:space-between;align-items:center">
<div>
<strong>Troca de Tamanho</strong>
<div style="font-size:12px;color:#6b7280">312 ocorrÃªncias</div>
</div>
<div style="text-align:right">
<div style="font-size:12px;color:#ef4444;font-weight:600">+18%</div>
</div>
</div>


<div role="listitem" class="card" style="display:flex;justify-content:space-between;align-items:center">
<div>
<strong>Erro no Cupom</strong>
<div style="font-size:12px;color:#6b7280">198 ocorrÃªncias</div>
</div>
<div style="text-align:right">
<div style="font-size:12px;color:#ef4444;font-weight:600">+40%</div>
</div>
</div>


</div>
</section>

</html>





<h2>Top Pareto Classifications (80%)</h2>

<ul>
  <% @pareto.each do |item| %>
    <li>
      <strong><%= item.tag %></strong>
      â€” <%= item.cum_pct.to_i %>% cumulative
    </li>
  <% end %>
</ul>

<%= link_to "â¬… Back to Conversations", root_path %>
